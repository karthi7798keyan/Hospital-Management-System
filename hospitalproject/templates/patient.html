{% extends 'dummy_base.html' %}

{% block title %}
Patient
{% endblock %}

{% block content %}
<style>
    .status-container {
        max-width: 700px;
        margin: 60px auto;
        padding: 40px;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        font-family: 'Poppins', sans-serif;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
    }

    input {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        margin-bottom: 12px;
        font-size: 15px;
    }

    button {
        padding: 10px 16px;
        background-color: #4b7bec;
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        letter-spacing: 0.4px;
    }

    button:hover {
        background-color: #3867d6;
        transform: scale(1.03);
        box-shadow: 0 4px 10px rgba(56, 103, 214, 0.4);
    }

    .cancel-btn {
        background-color: #e74c3c;
        color: white;
    }

    .cancel-btn:hover {
        background-color: #c0392b;
    }

    .details {
        margin-top: 25px;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
    }

    .no-result {
        color: red;
        margin-top: 20px;
    }

    .messages {
        margin-top: 15px;
        color: green;
        font-weight: 500;
    }
</style>

<div class="status-container">
    <h2>Check Your Appointment Status</h2>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <form method="POST">
        {% csrf_token %}
        <label>Enter Your Token Number:</label>
        <input type="text" name="token" placeholder="e.g., 1001" required>
        <button type="submit">Check Status</button>
    </form>

    {% if error %}
        <p class="no-result">{{ error }}</p>
    {% endif %}

    {% if token and not error %}
        {% if appointment %}
        <div class="details">
            <h3>Appointment Details</h3>
            <p><strong>Patient:</strong> {{ appointment.patient }}</p>
            <p><strong>Doctor:</strong> {{ appointment.doctor }}</p>
            <p><strong>Department:</strong> {{ appointment.department }}</p>
            <p><strong>Date:</strong> {{ appointment.date }}</p>
            <p><strong>Time:</strong> {{ appointment.time }}</p>
            <p><strong>Status:</strong> {{ appointment.status }}</p>
            <p><strong>Description:</strong> {{ appointment.description }}</p>

            {% if appointment.status != "Cancelled" %}
                <form method="post" action="{% url 'cancel_appointment' appointment.id %}" style="margin-top:15px;">
                    {% csrf_token %}
                    <button type="submit" class="cancel-btn">Cancel Appointment</button>
                </form>
            {% else %}
                <p style="color:red; margin-top:15px;">This appointment has been cancelled.</p>
            {% endif %}
        </div>
        {% else %}
            <p class="no-result">No appointment found for Token {{ token }}</p>
        {% endif %}

        {% if appointment %}
        <div style="margin-top:20px;">
            <a href="{% url 'download_pdf' appointment.id %}" class="btn btn-outline-primary btn-sm">
                Download All Details (PDF)
            </a>
        </div>
        {% endif %}
    {% endif %}  {# closes the outer if token #}

</div>
{% endblock %}
